<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.quant.persistence.mapper.StockDailyQuoteMapper">

    <insert id="upsertBatch">
        INSERT INTO stock_daily_quote (
            ts_code,
            trade_date,
            open,
            high,
            low,
            close,
            pre_close,
            change_amt,
            pct_chg,
            vol,
            amount,
            turnover_rate,
            create_time,
            update_time
        ) VALUES
        <foreach collection="list" item="item" separator=",">
            (
            #{item.tsCode},
            #{item.tradeDate},
            #{item.open},
            #{item.high},
            #{item.low},
            #{item.close},
            #{item.preClose},
            #{item.changeAmt},
            #{item.pctChg},
            #{item.vol},
            #{item.amount},
            #{item.turnoverRate},
            CURRENT_TIMESTAMP,
            CURRENT_TIMESTAMP
            )
        </foreach>
        ON DUPLICATE KEY UPDATE
            open = VALUES(open),
            high = VALUES(high),
            low = VALUES(low),
            close = VALUES(close),
            pre_close = VALUES(pre_close),
            change_amt = VALUES(change_amt),
            pct_chg = VALUES(pct_chg),
            vol = VALUES(vol),
            amount = VALUES(amount),
            turnover_rate = VALUES(turnover_rate),
            update_time = CURRENT_TIMESTAMP
    </insert>
</mapper>
